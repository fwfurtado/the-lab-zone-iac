# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json

import:
  - catalog/_vm.yaml

components:
  terraform:
    talos-cluster:
      metadata:
        terraform_workspace: "{{ .stack }}"
      vars:
        talos_version: "v1.7.5"
        talos_image_platform: "nocloud"
        talos_image_architecture: "amd64"
        talos_image_extensions:
          - "siderolabs/iscsi-tools"
          - "siderolabs/qemu-guest-agent"
        cluster_endpoint: "https://10.40.1.70:6443"
        cluster:
          name: "platform"
          description: "Talos platform cluster"
          tags:
            - "platform"
            - "k8s"
            - "talos"
            - "vm"
        nodes:
          - name: "cp-1"
            id: 200
            role: "controlplane"
            cpu: 4
            memory: 16384
            disk_size: 100
            ip_cidr: "10.40.1.70/24"
          - name: "worker-1"
            id: 201
            role: "worker"
            cpu: 6
            memory: 16384
            disk_size: 100
            ip_cidr: "10.40.1.71/24"
          - name: "worker-2"
            id: 202
            role: "worker"
            cpu: 6
            memory: 16384
            disk_size: 100
            ip_cidr: "10.40.1.72/24"
          - name: "worker-3"
            id: 203
            role: "worker"
            cpu: 6
            memory: 16384
            disk_size: 100
            ip_cidr: "10.40.1.73/24"
        controlplane_config_patches:
          - |
            cluster:
              allowSchedulingOnControlPlanes: true
