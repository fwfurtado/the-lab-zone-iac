# yaml-language-server: $schema=https://atmos.tools/schemas/atmos/atmos-manifest/1.0/atmos-manifest.json

import:
  - catalog/_vm.yaml

components:
  terraform:
    talos-cluster:
      metadata:
        terraform_workspace: "{{ .stack }}"
      vars:
        talos_version: "v1.7.5"
        talos_image_platform: "nocloud"
        talos_image_architecture: "amd64"
        talos_image_extensions:
          - "siderolabs/iscsi-tools"
          - "siderolabs/qemu-guest-agent"
        cluster_endpoint: "https://10.40.0.20:6443"
        cluster:
          name: "platform"
          description: "Talos platform cluster"
          tags:
            - "platform"
            - "k8s"
            - "talos"
            - "vm"
        nodes:
          - name: "cp-1"
            id: 200
            role: "controlplane"
            cpu: 4
            memory: 12288
            disk_size: 100
            ip_cidr: "10.40.0.20/24"
          - name: "worker-1"
            id: 201
            role: "worker"
            cpu: 6
            memory: 16384
            disk_size: 100
            ip_cidr: "10.40.0.21/24"
          - name: "worker-2"
            id: 202
            role: "worker"
            cpu: 6
            memory: 16384
            disk_size: 100
            # Bootstrap: VM bootou com DHCP (10.40.0.65). ip_cidr = IP atual para Terraform
            # conectar; static_ip_cidr = IP final a ser configurado no Talos.
            # Ap√≥s o primeiro apply bem-sucedido, volte para: ip_cidr: "10.40.0.22/24"
            ip_cidr: "10.40.0.65/24"
            static_ip_cidr: "10.40.0.22/24"
